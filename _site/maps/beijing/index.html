<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北京 Beijing / Line Maps by Project Chitose / 由千岁计划绘制的线路图</title>

    <!-- 搜索引擎优化项目 -->    
    <meta name="description" content="北京轨道交通线路图，支持在线预览和多版本下载">
    <meta name="keywords" content="北京,地铁,线路图,轨道交通">

    <link rel="stylesheet" href="/assets/css/global.css">
    <link rel="stylesheet" href="/assets/css/city-detail.css">

    <link rel="icon" href="/favicon.svg">

    <style>
        #logo-bar {
            width: 12px;
            height: 29px;
            background: url(/assets/logo-bar/beijing.svg);
        }        
    </style>
</head>
<body>
    <script>
        // 检查用户是否已完成 onboarding
        if (!localStorage.getItem('onboardingCompleted')) {
            // 如果当前不在 onboarding 页面，保存当前页面地址并跳转到 onboarding 页面
            if (!window.location.pathname.includes('onboarding')) {
                localStorage.setItem('intendedPage', window.location.pathname);
                window.location.href = '/onboarding';
            }
        }
    </script>
    <nav>
    <div id="nav-left-container">
        <a id="logo-container" class="no-a" href="/">
            <div id="logo">
                <div id="logo-bar"></div>
                <img src="/assets/images/logo.svg" alt="Line Maps">
            </div>
            <img src="/assets/images/byChitose.svg" alt="">
        </a>
        <div id="pc-nav-list" class="nav-list">
            <a class="nav-item" href="/">
                <span>首页</span>
                <span>HOME</span>
            </a>
            <a class="nav-item" href="/maps">
                <span>线路图</span>
                <span>MAPS</span>
            </a>
            <a class="nav-item" href="/news">
                <span>新闻</span>
                <span>NEWS</span>
            </a>
        </div>
    </div>
    <form action="https://www.bing.com/search" method="get" target="_blank" class="search-container" id="searchForm">
        <input type="text" name="q" class="search-input" id="searchBox" placeholder="">
        
        <button type="submit" class="search-button">搜索</button>
    </form>

    <button id="menu-button">
        <img src="/assets/icon/menu.svg" alt="MENU">
    </button>
</nav>

<div id="mobile-menu">
    <div id="mobile-nav-list" class="nav-list">
        <a class="nav-item" href="/">
            <span>首页</span>
            <span>HOME</span>
        </a>
        <a class="nav-item" href="/maps">
            <span>线路图</span>
            <span>MAPS</span>
        </a>
        <a class="nav-item" href="/news">
            <span>新闻</span>
            <span>NEWS</span>
        </a>
        <!-- <a class="nav-item">
            <span>搜索</span>
            <span>SEARCH</span>
        </a> -->
    </div>        
</div>

<script>
    // 在提交前，自动加上 site: 限制条件，但不修改搜索框本身的显示
    document.getElementById('searchForm').onsubmit = function(e) {
        e.preventDefault();
        var box = document.getElementById('searchBox');
        var originalValue = box.value;
        if (originalValue.trim() !== "") {
            // 构造包含site的搜索URL，搜索框本身值保持不变
            var searchUrl = "https://www.bing.com/search?q=" + encodeURIComponent(originalValue + " site:chitose.city");
            window.open(searchUrl, '_blank');
        }
        return false;
    };
    
    // 菜单按钮切换功能
    document.getElementById('menu-button').addEventListener('click', function() {
        var mobileMenu = document.getElementById('mobile-menu');
        var menuButton = document.getElementById('menu-button')
        var menuImg = menuButton.querySelector('img');
        mobileMenu.classList.toggle('active');
        menuButton.classList.toggle('active');
        
        // 根据active状态改变img的src
        if (menuButton.classList.contains('active')) {
            menuImg.src = '/assets/icon/menu-close.svg';
        } else {
            menuImg.src = '/assets/icon/menu.svg';
        }
    });
    
    // 监听窗口宽度变化，当菜单为active状态时取消
    window.addEventListener('resize', function() {
        var mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenu.classList.contains('active')) {
            mobileMenu.classList.remove('active');
        }
    });
</script>

        <script src="/assets/openseadragon/openseadragon.min.js"></script>
        
        
        <section id="main">
            <div id="city-header" class="city">
                <div class="city-name">
                    <span>北京</span>
                    <span>BEIJING</span>
                </div>
                <div class="city-bar">
                    <img src="/assets/cities/beijing.svg" alt="北京">
                </div>
            </div>

            <!-- 预览和版本选择 -->
            <section id="preview-section">
                <div class="sect-title">
                    <h1>预览</h1>
                </div>
                
                <!-- OpenSeadragon 容器 -->
                <div id="openseadragon-container"></div>

                <div class="release-selector">
                    <select id="releaseSelect">
                        
                            <option value="complete">完整版 - v1.0</option>
                        
                    </select>
                    <p class="release-description" id="releaseDesc">
                        
                        *已过时* 直到2025年的所有线路信息。
                    </p>
                </div>                
            </section>

            <div class="break"></div>

            <!-- 简介部分 -->
            <section id="intro-section">
                <div class="sect-title">
                    <h1>简介</h1>
                </div>
                <div class="intro-content">
                    <div class="intro-list">

<img src="/assets/images/map-introduction/beijing-1.svg" alt="">

<img src="/assets/images/map-introduction/beijing-2.svg" alt="">

<img src="/assets/images/map-introduction/beijing-3.svg" alt="">

</div>
                </div>
            </section>

            <div class="break"></div>

            <!-- 下载部分 -->
            <section id="download-section">
                <div class="sect-title">
                    <h1>所有版本</h1>
                    <span class="g1">点按版本即可下载线路图。</span>
                </div>
                <div class="download-container">
                    
                    
                        
                        
                        
                            
                            <div class="download-year-group">
                                <div class="year-header">
                                    <div class="year-box" style="background: #003770;"></div>                                    
                                    <span>2025</span>
                                </div>
                            
                        
                        
                        <div class="download-card" data-download="2025-complete">
                            <div class="card-row card-main">
                                <span class="card-name">完整版</span>
                                <div class="card-icons">
                                    
                                            <img src="/assets/icon/beijing/subway.svg" alt="subway" class="icon-subway">
                                    
                                            <img src="/assets/icon/beijing/tram.svg" alt="tram" class="icon-tram">
                                    
                                            <img src="/assets/icon/beijing/railway.svg" alt="railway" class="icon-railway">
                                    
                                </div>
                            </div>
                            <div class="card-row card-download">
                                <div class="download-info g1">
                                    <span>下载</span>
                                    <div class="links-container">
                                        <a href="/maps/file/beijing/Beijing-2025-1.0.png" download class="format-link g1 fl-row gap-6 ai-center">
                                            <img src="/assets/icon/download.svg" alt="下载" class="download-icon">
                                            <span>PNG <br> <span style="font-weight: 400;font-size: 14px;">10000*10000px</span></span>
                                        </a>
                                            <a href="/maps/file/beijing/Beijing-2025-1.0.pdf" download class="format-link g1 fl-row gap-6 ai-center">
                                            <img src="/assets/icon/download.svg" alt="下载" class="download-icon">
                                            <span>PDF</span>
                                        </a>
                                    </div>
                                </div>
                                <span class="license-note g1">下载代表您同意<a class="g1" href="/maps-terms">条款</a>。</span>
                            </div>
                        </div>
                    
                    </div>
                </div>
            </section>

            <!-- 更新历史 -->
            <section id="history-section">
                <div class="sect-title">
                    <h1>更新历史</h1>
                </div>
                <div class="history-list">
                    
                    <div class="history-item">
                        <div class="history-header">
                            <h1 class="version-number">1.0</h1>
                            <div class="history-meta">
                                <span class="version-badge release g1">
                                    正式版
                                </span>
                                <span class="history-date g1">2025-09-30</span>
                            </div>
                        </div>
                        <div class="history-brief">
                            <p>初始版本发布</p>
                        </div>
                    </div>
                    
                </div>
            </section>

            <p class="g1 bottom-note">*本页面出现的所有公共运输企业标志、商标等均由相关企业所有。</p>
        </section>

        <script>
            // 等待页面加载完成后初始化 OpenSeadragon
            document.addEventListener('DOMContentLoaded', function() {
                // OpenSeadragon 配置 - 使用 .szi 字段作为地图源
                const versionData = {
                    
                        "complete": "/maps/file/beijing/Beijing-2025-1.0.szi"
                    
                };

                let viewer = OpenSeadragon({
                    id: "openseadragon-container",
                    prefixUrl: "/assets/openseadragon/images/",
                    // 初始不直接传 tileSources，后面用 SziTileSource 异步打开
                    showFullPageButton: false,
                    showRotationControl: false,
                    animationTime: 0.3,
                    blendTime: 0.05,
                    springStiffness: 5.0,
                    constrainDuringPan: true,
                    maxZoomPixelRatio: 2,
                    minZoomImageRatio: 0.5,
                    visibilityRatio: 0.9,
                    showNavigator: false,
                    navigatorPosition: "BOTTOM_LEFT",
                    gestureSettingsMouse: {
                        scrollToZoom: true
                    },
                    gestureSettingsTouch: {
                        pinchToZoom: true,
                        clickToZoom: false
                    }
                });

                // 动态导入 SZI 模块并注册到 OpenSeadragon，然后打开初始 .szi
                const sziModuleUrl = "/assets/openseadragon/szi-tile-source-v0.7.0.js";
                const initialKey = Object.keys(versionData)[0];
                const loadSziModule = () => import(sziModuleUrl).then(mod => {
                    if (mod && mod.enableSziTileSource) mod.enableSziTileSource(OpenSeadragon);
                    return OpenSeadragon.SziTileSource;
                });

                if (initialKey) {
                    const initialSzi = versionData[initialKey];
                    loadSziModule().then(Szi => {
                        if (Szi && Szi.createSziTileSource) {
                            Szi.createSziTileSource(initialSzi).then(ts => viewer.open(ts)).catch(err => console.error('打开 SZI 失败', err));
                        } else {
                            try { viewer.open(initialSzi); } catch(e) { console.error(e); }
                        }
                    }).catch(err => {
                        console.error('加载 SZI 模块失败', err);
                        try { viewer.open(initialSzi); } catch(e) { console.error(e); }
                    });
                }

                // 预览版本选择器
                const releaseSelect = document.getElementById('releaseSelect');
                const releaseDesc = document.getElementById('releaseDesc');

                releaseSelect.addEventListener('change', function() {
                    const selectedRelease = this.value;
                    const sziSource = versionData[selectedRelease];
                    loadSziModule().then(Szi => {
                        if (Szi && Szi.createSziTileSource) {
                            Szi.createSziTileSource(sziSource).then(ts => viewer.open(ts)).catch(err => console.error('打开 SZI 失败', err));
                        } else {
                            try { viewer.open(sziSource); } catch(e) { console.error(e); }
                        }
                    }).catch(err => {
                        console.error('加载 SZI 模块失败', err);
                        try { viewer.open(sziSource); } catch(e) { console.error(e); }
                    });
                    
                    // 更新描述文本
                    const descriptions = {
                        
                            "complete": "*已过时* 直到2025年的所有线路信息。"
                        
                    };
                    releaseDesc.textContent = descriptions[selectedRelease];
                });

                // 下载卡片展开折叠功能
                const downloadCards = document.querySelectorAll('.download-card');
                downloadCards.forEach(card => {
                    const cardMain = card.querySelector('.card-main');
                    const cardDownload = card.querySelector('.card-download');
                    
                    cardMain.addEventListener('click', function() {
                        cardDownload.classList.toggle('active');
                    });
                });
            });
        </script>
    
    <div id="slogan" class="fl-row fl-nw gap-12 jc-center two-row">
        <span>现代的城市交通线网图</span>
        <span>Modern Urban Transit Line Maps</span>
    </div>
    <footer>
    <img src="/assets/images/site_logo.svg" alt="Chitose.City">
    <span style="font-size: 12px;font-weight: 500;">©Project Chitose 2025</span>
</footer>
</body>
